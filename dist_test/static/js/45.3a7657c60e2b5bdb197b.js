webpackJsonp([45],{1243:function(t,e,n){n(2198),n(2197);var a=n(20)(n(1650),n(2108),"data-v-4dc7f732",null);a.options.__file="D:\\baozWork\\liejing\\js\\ECMS\\src\\view\\systemManage\\editRobot.vue",a.esModule&&Object.keys(a.esModule).some(function(t){return"default"!==t&&"__esModule"!==t})&&console.error("named exports are not supported in *.vue files."),a.options.functional&&console.error("[vue-loader] editRobot.vue: functional components are not supported with templates, they should use render functions."),t.exports=a.exports},1650:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,o=n(4),i=n.n(o),s=n(137),r=n.n(s),l=n(32),d=n(93);e.default={components:{},name:"editRobot",data:function(){return{labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}},mediapath:"",queryForm:{mobile_serial_name:"",nickname:"",tel:""},previewVisible:!1,loading:!1,form:this.$form.createForm(this),headers:{Authorization:l.store.get("token")},robotLabelAll:[],robotLabel:[],is_number:!1,tip:"请输入11位手机号码",selectTagFlag:!1,robotInfo:{},editStatus:!1}},methods:(a={input_tel:function(t){var e=t.target.value,n=this;this.queryForm.tel=e;var a=/^-?(0|[1-9][0-9]*)(\.[0-9]*)?$/;!isNaN(e)&&a.test(e)?e.length>11?n.queryForm.tel=e.slice(0,e.length-1):11==e.length?(n.is_number=!0,n.tip=""):e.length<11&&(n.tip="请输入11位手机号码",n.is_number=!1):(n.is_number=!1,n.tip="请输入11位手机号码",function(){/^[0-9]+.?[0-9]*$/.test(e.charAt(e.length-1))||(console.log(e.charAt(e.length-1)),n.queryForm.tel=e.split(e.charAt(e.length-1)).join(""))}())},back:function(){this.$router.push({path:"/systemManage/robotManage"})},handleChange:function(t){if("uploading"===t.file.status)return void(this.loading=!0);"done"===t.file.status?1==t.file.response.status?(this.mediapath=t.file.response.data.path,this.loading=!1):this.$notification.warning({message:"上传错误",description:t.file.response.msg}):"error"===t.file.status&&this.$notification.warning({message:"上传失败",description:"文件"+t.file.name+"上传失败"})},beforeUpload:function(t){console.log("image/jpeg"===t.type);var e="image/jpeg"===t.type||("image/png"===t.type||"image/jpg"===t.type);e||this.$notification.warning({message:"文件格式不正确",description:"文件格式不正确，请选择JPG或PNG。"});var n=t.size/1024/1024<1;return n||(this.$notification.warning({message:"超出文件大小限制",description:"图像不能大于1MB！"}),this.$message.error("图像不能大于1MB！")),e&&n},deleteFn:function(){this.mediapath=""},com_handleOk:function(t){var e=this,n=this;if(!n.queryForm.mobile_serial_name)return!1;if(n.mediapath){var a={cmd:2031,fromClientId:this.$store.state.user.user.user_id,toClientId:n.queryForm.username,cmdData:{headImage:n.mediapath},priority:0};d.isOfflineRobot(n.queryForm.username,this.$store.state.user.offlineRobot)&&this.$store.commit("user/setRobotStatus","2"),this.$ws.sendMsgFun(a),this.$ws.cmd2031=function(t){4==t.status&&e.$notification.warning({message:function(e){return e("div",{domProps:{innerHTML:t.callbackMsg}})},description:"暂无法执行操作，请检查手机连接状态",duration:2,style:{background:"#fbf8e9"}})}}if(n.queryForm.nickname){var o={cmd:2027,fromClientId:this.$store.state.user.user.user_id,toClientId:n.queryForm.username,cmdData:{nickname:n.queryForm.nickname},priority:0};d.isOfflineRobot(n.queryForm.username,this.$store.state.user.offlineRobot)&&this.$store.commit("user/setRobotStatus","2"),this.$ws.sendMsgFun(o),this.$ws.cmd2027=function(t){4==t.status&&e.$notification.warning({message:function(e){return e("div",{domProps:{innerHTML:t.callbackMsg}})},description:"暂无法执行操作，请检查手机连接状态",duration:2,style:{background:"#fbf8e9"}})}}this.$axios({method:"POST",url:"/index.php?r=uc/system/robot-update",data:r()(n.queryForm,{avatar_url:n.mediapath})}).then(function(t){1==t.data.status&&(n.$notification.success({message:"成功",description:"保存成功",duration:1}),setTimeout(function(){n.$router.push({path:"/systemManage/robotManage"})},1e3))})},refreshGroup:function(){var t=this;this.$axios({method:"POST",url:"/index.php?r=uc/system/robot-detail",data:{robot_id:t.$route.query.id}}).then(function(e){var n=e.data;1==n.status&&(t.robotInfo=n.data.robot,t.robotLabel=n.data.robotLabel,t.queryForm.mobile_serial_name=n.data.robot.mobile_serial_name,t.queryForm.nickname=n.data.robot.nickname,t.queryForm.tel=n.data.robot.tel,t.mediapath=n.data.robot.avatar_url,t.queryForm.username=n.data.robot.username,t.queryForm.id=n.data.robot.id,t.robotLabelAll=n.data.robotLabelAll)})},addTag:function(){var t=this;this.robotLabelAll.forEach(function(e){t.robotLabel.forEach(function(t){e.id==t.id&&(e.check=!0)})}),this.selectTagFlag=!0}},i()(a,"deleteFn",function(t,e){t.stopPropagation(),this.mediapath=""}),i()(a,"edit_save",function(){this.editStatus?this.com_handleOk():this.editStatus=!this.editStatus}),i()(a,"handleTagChange",function(t,e,n){t.check=n,this.$set(this.robotLabelAll,e,t)}),i()(a,"handleTagOk",function(){var t=this,e=[];this.robotLabelAll.forEach(function(t){t.check&&e.push(t.id)}),this.$axios({method:"POST",url:"/index.php?r=uc/system/robot-save-label",data:{id:this.$route.query.id,robotLabel:e}}).then(function(e){1==e.data.status&&(t.selectTagFlag=!1,t.refreshGroup(),t.$message.success("保存成功"))})}),a),mounted:function(){this.$store.dispatch("setting/getBreadcrumb",this.$route)},updated:function(){this.$store.dispatch("setting/getBreadcrumb",this.$route)},created:function(){this.refreshGroup()},beforeDestroy:function(){this.$ws.cmd2027=null,this.$ws.cmd2031=null}}},1716:function(t,e,n){e=t.exports=n(15)(!1),e.push([t.i,"\n.up-content3 .ant-upload.ant-upload-select-picture-card {\n\twidth: 100px;\n\theight: 100px;\n}\n",""])},1717:function(t,e,n){e=t.exports=n(15)(!1),e.push([t.i,"\n.fr[data-v-4dc7f732] {\n  float: right;\n}\n.background-color[data-v-4dc7f732] {\n  background: #fff;\n  height: calc(100vh - 110px);\n  overflow-y: auto;\n}\n.mag_push_title[data-v-4dc7f732] {\n  border-bottom: 10px solid #efefef;\n  padding: 17px 25px;\n  font-size: 16px;\n  background: #fff;\n  font-weight: 700;\n}\n.upload[data-v-4dc7f732] {\n  position: relative;\n  height: 112px;\n  width: 112px;\n  margin-left: 25%;\n  float: none !important;\n}\n.upload .up_loading[data-v-4dc7f732] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  margin-top: -7px;\n  margin-left: -7px;\n}\n.upload svg[data-v-4dc7f732] {\n  font-size: 22px;\n}\n.loading[data-v-4dc7f732] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  margin-top: -7px;\n  margin-left: -7px;\n}\n.info[data-v-4dc7f732] {\n  background: #ffffff;\n  border-bottom: 10px solid #efefef;\n}\n.info .info-header[data-v-4dc7f732] {\n  padding: 10px 25px;\n  border-bottom: 2px solid #f0f2f5;\n  height: 52px;\n  line-height: 32px;\n}\n.info .info-header span[data-v-4dc7f732] {\n  font-weight: 700;\n  font-size: 16px;\n}\n.info .info-content[data-v-4dc7f732] {\n  padding: 10px 25px;\n}\n.info .info-content .ant-tag[data-v-4dc7f732]:hover {\n  background: #5AA9CD;\n  color: #ffffff;\n  opacity: 1;\n}\n.info .info-content .ant-form-item[data-v-4dc7f732] {\n  margin-bottom: 12px;\n}\n.up-content3[data-v-4dc7f732] {\n  display: inline-block;\n  vertical-align: middle;\n  position: relative;\n}\n.up-content3 .up-img-content[data-v-4dc7f732] {\n  position: absolute;\n  top: 1px;\n  left: 1px;\n  right: 9px;\n  bottom: 9px;\n  background: #ffffff;\n}\n.up-content3 .up-img-content img[data-v-4dc7f732] {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  vertical-align: top;\n  position: relative;\n}\n.up-content3 .up-img-modal[data-v-4dc7f732] {\n  position: absolute;\n  top: 1px;\n  left: 1px;\n  right: 9px;\n  bottom: 9px;\n  z-index: 10;\n  visibility: hidden;\n}\n.up-content3 .up-img-modal .img-btn1[data-v-4dc7f732] {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  z-index: 10;\n  left: 20%;\n  font-size: 20px;\n}\n.up-content3 .up-img-modal .img-btn2[data-v-4dc7f732] {\n  position: absolute;\n  top: 50%;\n  transform: translateY(-50%);\n  z-index: 10;\n  left: 65%;\n  font-size: 20px;\n}\n.up-content3:hover .up-img-modal[data-v-4dc7f732] {\n  background: rgba(250, 250, 250, 0.51);\n  visibility: visible;\n}\n",""])},2108:function(t,e,n){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"background-color"},[n("div",{staticClass:"mag_push_title"},[t._v("\n\t\t详情\n\t\t"),n("a-button",{staticStyle:{float:"right","z-index":"1",position:"relative",top:"-4px"},attrs:{type:"default",icon:"left"},on:{click:function(e){return t.back()}}},[t._v("返回")])],1),t._v(" "),n("div",{staticClass:"info"},[n("div",{staticClass:"info-header"},[n("span",[t._v("微信信息")]),t._v(" "),n("a-button",{staticClass:"fr",staticStyle:{width:"70px"},attrs:{type:"primary"},on:{click:t.edit_save}},[t._v(t._s(t.editStatus?"保存":"编辑"))])],1),t._v(" "),n("div",{staticClass:"info-content"},[n("div",{staticStyle:{width:"400px",display:"inline-block","vertical-align":"middle"}},[n("a-form",{attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.com_handleOk(e)}}},[n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"编号："}},[t.editStatus?n("a-input",{attrs:{placeholder:"请输入编号",maxlength:"15"},model:{value:t.queryForm.mobile_serial_name,callback:function(e){t.$set(t.queryForm,"mobile_serial_name",e)},expression:"queryForm.mobile_serial_name"}}):n("span",[t._v(t._s(t.queryForm.mobile_serial_name))])],1),t._v(" "),n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"昵称："}},[t.editStatus?n("a-input",{attrs:{placeholder:"请输入昵称",maxlength:"10"},model:{value:t.queryForm.nickname,callback:function(e){t.$set(t.queryForm,"nickname",e)},expression:"queryForm.nickname"}}):n("span",[t._v(t._s(t.queryForm.nickname))])],1),t._v(" "),n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"电话："}},[t.editStatus?n("a-input",{attrs:{placeholder:"请输入手机号",maxlength:"11"},on:{change:t.input_tel},model:{value:t.queryForm.tel,callback:function(e){t.$set(t.queryForm,"tel",e)},expression:"queryForm.tel"}}):n("span",[t._v(t._s(t.queryForm.tel))])],1),t._v(" "),n("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"头像："}},[t.editStatus?n("a-upload",{staticClass:"up-content3",attrs:{name:"file",headers:t.headers,listType:"picture-card",showUploadList:!1,beforeUpload:t.beforeUpload,action:"/index.php?r=uc/user/upload"},on:{change:t.handleChange}},[n("div",[n("a-icon",{staticStyle:{fontSize:"20px"},attrs:{type:"plus"}}),t._v(" "),n("div",{staticClass:"ant-upload-text"},[t._v("上传图片")])],1),t._v(" "),""!=t.mediapath?n("div",{staticClass:"up-img-content"},[n("img",{attrs:{src:t.mediapath,alt:""}})]):t._e(),t._v(" "),""!=t.mediapath?n("div",{staticClass:"up-img-modal"},[n("a-icon",{staticClass:"img-btn1",attrs:{type:"form"}}),t._v(" "),n("a-icon",{staticClass:"img-btn2",attrs:{type:"delete"},on:{click:function(e){return t.deleteFn(e,"1")}}})],1):t._e()]):n("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.mediapath,alt:""}})],1)],1)],1),t._v(" "),n("div",{staticStyle:{width:"calc(100% - 450px)",display:"inline-block","text-align":"right"}},[n("img",{staticStyle:{width:"180px",height:"180px"},attrs:{src:t.robotInfo.qrcode,alt:""}})])])]),t._v(" "),n("div",{staticClass:"info"},[n("div",{staticClass:"info-header"},[n("span",[t._v("微信标签")]),t._v(" "),n("a-button",{staticClass:"fr",staticStyle:{width:"70px"},attrs:{type:"primary"},on:{click:t.addTag}},[t._v("打标签")])],1),t._v(" "),n("div",{staticClass:"info-content"},t._l(t.robotLabel,function(e,a){return n("a-tag",{key:e.id,class:["tag-color"+e.color_id],staticStyle:{"margin-bottom":"10px"}},[t._v("\n\t\t\t\t"+t._s(e.title)+"\n\t\t\t")])}),1)]),t._v(" "),n("div",{staticClass:"info",staticStyle:{"border-bottom":"none"}},[n("div",{staticClass:"info-header"},[n("span",[t._v("其他信息")]),t._v(" "),n("a-button",{staticClass:"fr",staticStyle:{width:"70px"},attrs:{type:"primary"},on:{click:function(e){return t.refreshGroup()}}},[t._v("刷新")])],1),t._v(" "),n("div",{staticClass:"info-content"},[n("a-row",[n("a-col",{attrs:{xl:3,md:6,xs:12}},[n("span",[t._v("\n\t\t\t\t\t\t所属部门："+t._s(t.robotInfo.department)+"\n\t\t\t\t\t")])]),t._v(" "),n("a-col",{attrs:{xl:3,md:6,xs:12}},[n("span",[t._v("\n\t\t\t\t\t\t所属用户：\n\t\t\t\t\t\t"),t.robotInfo.user_avatar?n("img",{staticStyle:{width:"30px",height:"30px","vertical-align":"middle"},attrs:{src:t.robotInfo.user_avatar,alt:""}}):t._e(),t._v(" "),n("span",[t._v(t._s(t.robotInfo.user))])])])],1),t._v(" "),n("a-row",[n("a-col",{attrs:{xl:3,md:6,xs:12}},[n("span",[t._v("\n\t\t\t\t\t\tApp版本："+t._s(t.robotInfo.vision)+"\n\t\t\t\t\t")])]),t._v(" "),n("a-col",{attrs:{xl:3,md:6,xs:12}},[n("span",[t._v("\n\t\t\t\t\t\t绑定时间："+t._s(t.robotInfo.created)+"\n\t\t\t\t\t")])]),t._v(" "),n("a-col",{attrs:{xl:3,md:6,xs:12}},[n("span",[t._v("\n\t\t\t\t\t\t心跳状态：\n\t\t\t\t\t\t"),"1"==t.robotInfo.status?n("div",{staticStyle:{display:"inline-block"}},[n("span",{staticStyle:{width:"10px",height:"10px",display:"inline-block","border-radius":"50%",background:"#259B24","margin-right":"5px"}}),t._v(" "),n("span",[t._v("已连接")])]):n("div",{staticStyle:{display:"inline-block"}},[n("span",{staticStyle:{width:"10px",height:"10px",display:"inline-block","border-radius":"50%",background:"#BCBCBD","margin-right":"5px"}}),t._v(" "),n("span",[t._v("未连接")])])])]),t._v(" "),n("a-col",{attrs:{xl:3,md:6,xs:12}},[n("span",[t._v("\n\t\t\t\t\t\t上次心跳："+t._s(t.robotInfo.active_time)+"\n\t\t\t\t\t")])])],1)],1)]),t._v(" "),n("a-modal",{attrs:{title:"选择标签",cancelText:"取消",okText:"确定",visible:t.selectTagFlag},on:{ok:t.handleTagOk,cancel:function(e){t.selectTagFlag=!1}}},[n("div",{staticClass:"tag-modal"},t._l(t.robotLabelAll,function(e,a){return n("a-checkable-tag",{key:e.id,class:["tag-color"+e.color_id],staticStyle:{"margin-bottom":"5px"},attrs:{checked:e.check},on:{change:function(n){return t.handleTagChange(e,a,n)}}},[t._v("\n\t\t\t\t"+t._s(e.title)+"\n\t\t\t")])}),1)])],1)},staticRenderFns:[]},t.exports.render._withStripped=!0},2197:function(t,e,n){var a=n(1716);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n(16)("12874b5d",a,!1)},2198:function(t,e,n){var a=n(1717);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n(16)("04788f6a",a,!1)}});